/* InfiScroll */"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var i=[],n=!0,r=!1,s=void 0;try{for(var l,_=e[Symbol.iterator]();!(n=(l=_.next()).done)&&(i.push(l.value),!t||i.length!==t);n=!0);}catch(e){r=!0,s=e}finally{try{n||null==_.return||_.return()}finally{if(r)throw s}}return i}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(){var S="InfiScroll",h=Object.freeze({TRESHOLD:"treshold",ELEMENT_LIMIT:"elementLimit",SIZE:"size",QUERY:"generator",FIXED_SIZE:"fixedSize",CHILD_SIZE:"childSize",CACHE_SIZE:"cacheSize",INVALIDATE_CHECK:"check",DOM_DELETE:"domDelete",TOGGLE_SPINNER:"spinner",THROTTLE_SCROLL:"throttleScroll",KEEP_POSITION_ON_RELOAD:"keepPositionOnReload",BATCH_LOAD:"batchLoad"});if(!window)throw new Error("".concat(S," cannot be used in non-browser environment"));function p(e,t,i,n){if(!n)return[0];var r,s,l=Math.max(e-i,0)/n>>>0,_=t+2*i-(l*n-e),o=Math.ceil(_/n);return r=l,s=o,Array.from(Array(s||1),function(e,t){return r+t})}function o(e){return"__".concat(S,"_").concat(this.__uniqueIdentifier,"_index_").concat(e)}function L(n){for(var r=this,s=new Map,e=arguments.length,t=new Array(1<e?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return t.reduce(function(e,t){return e.concat(t)}).forEach(function(e){var t=o.call(r,e),i=document.getElementById(t);i&&(s.set(e,i),n.removeChild(i))}),s}function w(e,t,i){var n=e*this.__childSize;if(t.style.position="absolute",t.style.margin=0,t.style.top="".concat(n,"px"),t.style.left=0,t.style.right=0,t.id=o.call(this,e),this.__childSize&&(t.style.height="".concat(this.__childSize,"px")),i){var r=t.id,s=document.getElementById(r);this.element.insertBefore(t,s),this.element.removeChild(s)}else this.element.appendChild(t);this.__childSize||(this.__childSize=t.scrollHeight,this.__treshold=a.call(this),function(){var e=!0,t=!1,i=void 0;try{for(var n,r=this.__domElements[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var s=n.value,l=o.call(this,s),_=document.getElementById(l);_&&(_.style.height="".concat(this.__childSize,"px"))}}catch(e){t=!0,i=e}finally{try{e||null==r.return||r.return()}finally{if(t)throw i}}}.call(this),setTimeout(this.invalidate.bind(this),0),this.__fixedSize&&f.call(this)),e===this.__size-1&&(this.__finalElement&&this.__finalElement!==t&&this.__finalElement.classList.remove("last-of-list"),t.classList.add("last-of-list"),this.__finalElement=t),T.call(this,e)}function T(e){if(this.__childSize&&this.__size){var t=e*this.__childSize;if(!(e===this.__size-1)){var i=this.__currentScrollHeight,n=this.__size*this.__childSize,r=t+5*this.__childSize;if(i<r){var s=Math.min(n,r);this.__dummyElement.style.top="".concat(s,"px"),this.__currentScrollHeight=s,this.__dummyElement.offsetParent||this.element.appendChild(this.__dummyElement)}}}}function a(){return this.__tresholdFactor*this.__childSize}function f(){if(this.__fixedSize){var e=this.__childSize*(this.__size+1);this.__dummyElement.style.top="".concat(e,"px"),this.element.appendChild(this.__dummyElement)}}function I(r,s,l){var _=this;if(!l)throw Error("Null uniqueIdentifier");if(null==s||s.constructor===Array&&0===s.length)if(r.constructor===Array){var e=!0,t=!1,i=void 0;try{for(var n,o=r[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var h=n.value;this.__queries.delete(h)}}catch(e){t=!0,i=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw i}}}else this.__queries.delete(r);else if(this.__uniqueIdentifier===l)if(r.constructor!==Array){if(!(s instanceof HTMLElement))throw Error("".concat(S," query callback resolved with non-HTMLElement result."));if(this.__queries.delete(r),0===this.__queries.size&&this.__reloading){if(this.__reloading=!1,this.__reloadingChildrenToRemove){var a=!0,c=!1,u=void 0;try{for(var d,f=this.__reloadingChildrenToRemove[Symbol.iterator]();!(a=(d=f.next()).done);a=!0){var m=d.value;this.element.removeChild(m)}}catch(e){c=!0,u=e}finally{try{a||null==f.return||f.return()}finally{if(c)throw u}}this.__reloadingChildrenToRemove=null}if(this.__reloadAfterInvalidation){this.__reloadAfterInvalidation=!1;var v=this.reload.bind(this);return void setTimeout(function(){return v()},1e3)}}this.__cache.delete(r);var y=this.__cacheQueue.indexOf(r);-1!=y&&this.__cacheQueue.splice(y,1),this.__domElements.add(r),(!this.__lastItemGenerated||r>this.__lastItemGenerated)&&(this.__lastItemGenerated=r),w.call(this,r,s)}else for(var E=function(e){var t=r[e],i=s[e],n=I.bind(_);setTimeout(function(){return n(t,i,l)},0)},p=0;p<r.length;p++)E(p)}function e(e,t){var i=this;if(!(e instanceof HTMLElement))throw Error("".concat(e," is not instance of HTMLElement"));this.element=e;var n=window.getComputedStyle(e);if(!~["absolute","relative"].indexOf(n.position))throw Error("".concat(e," must have position of 'absolute' or 'relative'"));if(!t)throw Error("options argument must be passed to ".concat(S," constructor"));this.__resizeListener=function(){i.invalidate()},window.addEventListener("resize",this.__resizeListener);var r=this.element.id;r||(r=1e6*Math.random()>>>0);var s,l,_=null;for(this.__scrollListener=function(){if(i.__throttleScroll){null!==_&&clearTimeout(_);var e=i;_=setTimeout(function(){e.invalidate(),_=null},50)}else i.invalidate()},this.__scrollListener=this.__scrollListener.bind(this),e.addEventListener("scroll",this.__scrollListener);this.element.firstChild;)this.element.removeChild(this.element.firstChild);if(this.__domElements=new Set,this.__inView=new Set,this.__queue=[],this.__cacheQueue=[],this.__cache=new Map,this.__queries=new Set,this.__updateRequests=new Map,this.__uniqueIdentifier=r,this.__spinnerTimeout=null,this.__currentScrollHeight=0,function(t){for(var e=arguments.length,i=new Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];var r=i.filter(function(e){return!(e in t)});if(r.length)throw Error("Options object is missing required properties ".concat(r))}(t,h.QUERY),this.__query=t[h.QUERY],this.__check=t[h.INVALIDATE_CHECK],this.__childSize=t[h.CHILD_SIZE],this.__fixedSize=t[h.FIXED_SIZE],this.__size=t[h.SIZE],this.__elementLimit=t[h.ELEMENT_LIMIT],this.__cacheSize=t[h.CACHE_SIZE],this.__domDelete=t[h.DOM_DELETE],this.__spinner=t[h.TOGGLE_SPINNER],this.__keepPositionOnReload=t[h.KEEP_POSITION_ON_RELOAD],this.__batchLoad=t[h.BATCH_LOAD],this.__throttleScroll=!(h.THROTTLE_SCROLL in t)||t[h.THROTTLE_SCROLL],this.__tresholdFactor=h.TRESHOLD in t?t[h.TRESHOLD]:.5,this.__uniqueIdentifier=1e6*Math.random()>>>0,this.__childSize&&(this.__treshold=a.call(this)),this.__spinner){if("function"!=typeof this.__spinner)throw Error("Given spinner callback is not function. Provide a function which takes a single boolean parameter.");this.__spinner(!0)}(l=Object.keys(t).filter(function(e){return!~Object.values(h).indexOf(e)})).length&&(s="Options object contained invalid options '".concat(l,"'. Typos?"),console.warn("".concat(S,": ").concat(s)));var o=document.createElement("div");o.style.height=o.style.width="1px",o.style.visibility="hidden",o.style.position="absolute",this.__dummyElement=o,f.call(this),setTimeout(this.invalidate.bind(this),0)}if(e.prototype.reload=function(){if(this.__reloading)this.__reloadAfterInvalidation=!0;else{this.__reloading=!0;var e=this.element.childNodes,t=[],i=!0,n=!1,r=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var _=s.value;-1!==_.id.indexOf(S)&&t.push(_)}}catch(e){n=!0,r=e}finally{try{i||null==l.return||l.return()}finally{if(n)throw r}}this.__reloadingChildrenToRemove=t,this.__domElements.clear(),this.__inView.clear(),this.__cache.clear(),this.__queries.clear(),this.__updateRequests.clear(),this.__queue=[],this.__cacheQueue=[],this.__keepPositionOnReload||(this.__dummyElement.top=0,this.__currentScrollHeight=0),this.__uniqueIdentifier=1e6*Math.random()>>>0;var o=this.invalidate.bind(this);setTimeout(function(){return o()},0)}},e.prototype.invalidate=function(){var a=this;if(!(0<arguments.length&&void 0!==arguments[0]&&arguments[0]))if(this.__check){if(!this.__check())return}else if(null===this.element.offsetParent)return;var e=p(this.element.scrollTop,this.element.clientHeight,this.__treshold,this.__childSize),t=e.filter(function(e){return!a.__domElements.has(e)});if(this.__inView=new Set(e),t.filter(function(e){return!a.__size||e<=a.__size}),this.__elementLimit){for(var c=[],i=0;this.__queue.length>this.__elementLimit&&i++<this.__queue.length;){var n=this.__queue.shift();this.__inView.has(n)||this.__queries.has(n)||c.push(n)}if(c.length){setTimeout(function(){var e=L.call(a,a.element,c),t=!0,i=!1,n=void 0;try{for(var r,s=e.entries()[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var l=_slicedToArray(r.value,2),_=l[0],o=l[1];a.__cacheQueue.push(_),a.__cache.set(_,o),a.__domElements.delete(_),a.__domDelete&&__domDelete(o)}}catch(e){i=!0,n=e}finally{try{t||null==s.return||s.return()}finally{if(i)throw n}}for(;a.__cacheSize&&a.__cacheQueue.length>a.__cacheSize;){var h=a.__cacheQueue.shift();a.__cache.delete(h)}}.bind(this),0)}}var r=[],s=this.__uniqueIdentifier,l=null,_=!0,o=!1,h=void 0;try{for(var u,d=t[Symbol.iterator]();!(_=(u=d.next()).done);_=!0){var f=u.value;this.__size&&f>=this.__size||(this.__spinner&&function(){a.__spinner(!0),clearTimeout(a.__spinnerTimeout);var e=a.__spinner;a.__spinnerTimeout=setTimeout(function(){return e(!1)},100)}(),this.__queries.has(f)||(this.__queue.push(f),this.__cache.has(f)?I.call(this,f,this.__cache.get(f),s):(this.__queries.add(f),r.push(f))),l=f)}}catch(e){o=!0,h=e}finally{try{_||null==d.return||d.return()}finally{if(o)throw h}}if(l&&T.call(this,l),r.length){var m=I.bind(this),v=this.__query.bind(this);if(this.__batchLoad)v(r,function(e){return m(r,e,s)});else for(var y=function(){var t=r[E];v(t,function(e){return m(t,e,s)})},E=0;E<r.length;E++)y()}},e.prototype.updateItem=function(t){var i=this;if(this.__domElements.has(t)){var n=1e3*Math.random()>>>0;this.__updateRequests.set(t,n);for(var e=arguments.length,r=new Array(1<e?e-1:0),s=1;s<e;s++)r[s-1]=arguments[s];this.__query.apply(this,[t,function(e){e&&(e.constructor===Array&&(e=e[0]),i.__updateRequests.get(t)===n&&w.call(i,t,e,!0))}].concat(r))}},e.prototype.updateSize=function(e){if(!e||+e<0)throw Error("Invalid size ".concat(e));var t=+e;if(t!==this.__size){this.__size=t,f.call(this);var i=t*this.__childSize;i<Number.parseInt(this.__dummyElement.style.top)&&(this.__dummyElement.style.top="".concat(i,"px"),this.__currentScrollHeight=i,this.element.scrollTop=i-this.element.clientHeight);var n=[],r=!0,s=!1,l=void 0;try{for(var _,o=this.__domElements[Symbol.iterator]();!(r=(_=o.next()).done);r=!0){var h=_.value;t<h&&n.push(h)}}catch(e){s=!0,l=e}finally{try{r||null==o.return||o.return()}finally{if(s)throw l}}if(n.length){L.call(this,this.element,n);for(var a=0;a<n.length;a++){var c=n[a];this.__domElements.delete(c),this.__cache.delete(c);var u=this.__queue.indexOf(c);-1!==u&&this.__queue.splice(u,1);var d=this.__cacheQueue.indexOf(c);-1!==d&&this.__cacheQueue.splice(d,1)}}}},e.prototype.dispose=function(){window.removeEventListener("resize",this.__resizeListener),this.element.removeEventListener("scroll",this.__scrollListener)},S in window)throw new Error("CLASH: Global property ".concat(S," exist already in window!"));window[S]=e}();