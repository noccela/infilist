/* InfiScroll */"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var i=[],n=!0,r=!1,s=void 0;try{for(var l,o=e[Symbol.iterator]();!(n=(l=o.next()).done)&&(i.push(l.value),!t||i.length!==t);n=!0);}catch(e){r=!0,s=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw s}}return i}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(){var S="InfiScroll",h=Object.freeze({TRESHOLD:"treshold",ELEMENT_LIMIT:"elementLimit",SIZE:"size",QUERY:"generator",FIXED_SIZE:"fixedSize",CHILD_SIZE:"childSize",CACHE_SIZE:"cacheSize",INVALIDATE_CHECK:"check",DOM_DELETE:"domDelete",TOGGLE_SPINNER:"spinner",THROTTLE_SCROLL:"throttleScroll",KEEP_POSITION_ON_RELOAD:"keepPositionOnReload",BATCH_LOAD:"batchLoad"});if(!window)throw new Error("".concat(S," cannot be used in non-browser environment"));function T(e,t,i,n){if(!n)return[0];var r,s,l=Math.max(e-i,0)/n>>>0,o=t+2*i-(l*n-e),_=Math.ceil(o/n);return r=l,s=_,Array.from(Array(s||1),function(e,t){return r+t})}function _(e){return"__".concat(S,"_").concat(this.__uniqueIdentifier,"_index_").concat(e)}function L(n){for(var r=this,s=new Map,e=arguments.length,t=new Array(1<e?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return t.reduce(function(e,t){return e.concat(t)}).forEach(function(e){var t=_.call(r,e),i=document.getElementById(t);i&&(s.set(e,i),n.removeChild(i))}),s}function g(e,t,i){var n=e*this.__childSize;if(t.style.position="absolute",t.style.margin=0,t.style.top="".concat(n,"px"),t.style.left=0,t.style.right=0,t.id=_.call(this,e),this.__childSize&&(t.style.height="".concat(this.__childSize,"px")),i){var r=t.id,s=document.getElementById(r);this.element.insertBefore(t,s),this.element.removeChild(s)}else this.element.appendChild(t);this.__childSize||(this.__childSize=t.scrollHeight,this.__treshold=a.call(this),function(){var e=!0,t=!1,i=void 0;try{for(var n,r=this.__domElements[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var s=n.value,l=_.call(this,s),o=document.getElementById(l);o&&(o.style.height="".concat(this.__childSize,"px"))}}catch(e){t=!0,i=e}finally{try{e||null==r.return||r.return()}finally{if(t)throw i}}}.call(this),setTimeout(this.invalidate.bind(this),0),this.__fixedSize&&f.call(this)),e===this.__size-1&&(this.__finalElement&&this.__finalElement!==t&&this.__finalElement.classList.remove("last-of-list"),t.classList.add("last-of-list"),this.__finalElement=t),w.call(this,e)}function w(e){if(this.__childSize&&this.__size){var t=e*this.__childSize;if(!(e===this.__size-1)){var i=this.__currentScrollHeight,n=this.__size*this.__childSize,r=t+5*this.__childSize;if(i<r){var s=Math.min(n,r);this.__dummyElement.style.top="".concat(s,"px"),this.__currentScrollHeight=s,z(this.__dummyElement)||this.element.appendChild(this.__dummyElement)}}}}function a(){return this.__tresholdFactor*this.__childSize}function f(){if(this.__fixedSize){var e=this.__childSize*(this.__size+1);this.__dummyElement.style.top="".concat(e,"px"),this.element.appendChild(this.__dummyElement)}}function z(e){return e.offsetParent}function I(r,s,l){var o=this;if(!l)throw Error("Null uniqueIdentifier");if(console.log("generated ".concat(r)),null==s||s.constructor===Array&&0===s.length)if(r.constructor===Array){var e=!0,t=!1,i=void 0;try{for(var n,_=r[Symbol.iterator]();!(e=(n=_.next()).done);e=!0){var h=n.value;this.__queries.delete(h)}}catch(e){t=!0,i=e}finally{try{e||null==_.return||_.return()}finally{if(t)throw i}}}else this.__queries.delete(r);else if(this.__uniqueIdentifier===l)if(r.constructor!==Array){if(!(s instanceof HTMLElement))throw Error("".concat(S," query callback resolved with non-HTMLElement result."));if(this.__queries.delete(r),0===this.__queries.size&&this.__reloading){if(this.__reloading=!1,this.__reloadingChildrenToRemove){var a=!0,c=!1,u=void 0;try{for(var d,f=this.__reloadingChildrenToRemove[Symbol.iterator]();!(a=(d=f.next()).done);a=!0){var m=d.value;this.element.removeChild(m)}}catch(e){c=!0,u=e}finally{try{a||null==f.return||f.return()}finally{if(c)throw u}}this.__reloadingChildrenToRemove=null}if(this.__reloadAfterInvalidation){this.__reloadAfterInvalidation=!1;var v=this.reload.bind(this);setTimeout(function(){return v()},10)}}this.__cache.delete(r);var y=this.__cacheQueue.indexOf(r);-1!=y&&this.__cacheQueue.splice(y,1),this.__domElements.add(r),g.call(this,r,s)}else for(var E=function(e){var t=r[e],i=s[e],n=I.bind(o);setTimeout(function(){return n(t,i,l)},0)},p=0;p<r.length;p++)E(p)}function e(e,t){var i=this;if(!(e instanceof HTMLElement))throw Error("".concat(e," is not instance of HTMLElement"));this.element=e;var n=window.getComputedStyle(e);if(!~["absolute","relative"].indexOf(n.position))throw Error("".concat(e," must have position of 'absolute' or 'relative'"));if(!t)throw Error("options argument must be passed to ".concat(S," constructor"));this.__resizeListener=function(){i.invalidate()},window.addEventListener("resize",this.__resizeListener);var r=this.element.id;r||(r=1e6*Math.random()>>>0);var s,l,o=null;for(this.__scrollListener=function(){if(i.__throttleScroll){null!==o&&clearTimeout(o);var e=i;o=setTimeout(function(){e.invalidate(),o=null},50)}else i.invalidate()},this.__scrollListener=this.__scrollListener.bind(this),e.addEventListener("scroll",this.__scrollListener);this.element.firstChild;)this.element.removeChild(this.element.firstChild);if(this.__domElements=new Set,this.__inView=new Set,this.__queue=[],this.__cacheQueue=[],this.__cache=new Map,this.__queries=new Set,this.__updateRequests=new Map,this.__uniqueIdentifier=r,this.__spinnerTimeout=null,this.__currentScrollHeight=0,function(t){for(var e=arguments.length,i=new Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];var r=i.filter(function(e){return!(e in t)});if(r.length)throw Error("Options object is missing required properties ".concat(r))}(t,h.QUERY),this.__query=t[h.QUERY],this.__check=t[h.INVALIDATE_CHECK],this.__childSize=t[h.CHILD_SIZE],this.__fixedSize=t[h.FIXED_SIZE],this.__size=t[h.SIZE],this.__elementLimit=t[h.ELEMENT_LIMIT],this.__cacheSize=t[h.CACHE_SIZE],this.__domDelete=t[h.DOM_DELETE],this.__spinner=t[h.TOGGLE_SPINNER],this.__keepPositionOnReload=t[h.KEEP_POSITION_ON_RELOAD],this.__batchLoad=t[h.BATCH_LOAD],this.__throttleScroll=!(h.THROTTLE_SCROLL in t)||t[h.THROTTLE_SCROLL],this.__tresholdFactor=h.TRESHOLD in t?t[h.TRESHOLD]:.5,this.__uniqueIdentifier=1e6*Math.random()>>>0,this.__childSize&&(this.__treshold=a.call(this)),this.__spinner){if("function"!=typeof this.__spinner)throw Error("Given spinner callback is not function. Provide a function which takes a single boolean parameter.");this.__spinner(!0)}(l=Object.keys(t).filter(function(e){return!~Object.values(h).indexOf(e)})).length&&(s="Options object contained invalid options '".concat(l,"'. Typos?"),console.warn("".concat(S,": ").concat(s)));var _=document.createElement("div");_.style.height=_.style.width="1px",_.style.visibility="hidden",_.style.position="absolute",this.__dummyElement=_,f.call(this),setTimeout(this.invalidate.bind(this),0)}if(e.prototype.reload=function(){if(this.__reloading)this.__reloadAfterInvalidation=!0;else{this.__reloading=!0;var e=this.element.childNodes,t=[],i=!0,n=!1,r=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var o=s.value;-1!==o.id.indexOf(S)&&t.push(o)}}catch(e){n=!0,r=e}finally{try{i||null==l.return||l.return()}finally{if(n)throw r}}this.__reloadingChildrenToRemove=t,this.__domElements.clear(),this.__inView.clear(),this.__cache.clear(),this.__queries.clear(),this.__updateRequests.clear(),this.__queue=[],this.__cacheQueue=[],this.__keepPositionOnReload||(this.__dummyElement.top=0,this.__currentScrollHeight=0),this.__uniqueIdentifier=1e6*Math.random()>>>0;var _=this.invalidate.bind(this);setTimeout(function(){return _()},0)}},e.prototype.invalidate=function(){var a=this;if(!(0<arguments.length&&void 0!==arguments[0]&&arguments[0]))if(this.__check){if(!this.__check())return}else if(null===z(this.element))return;var e=this.element.scrollTop,t=this.element.clientHeight;e||z(this.element)||!this.__lastScrollTop||(e=this.__lastScrollTop);var i=T(this.__lastScrollTop=e,t,this.__treshold,this.__childSize),n=i.filter(function(e){return!a.__domElements.has(e)});if(this.__inView=new Set(i),n.filter(function(e){return!a.__size||e<=a.__size}),this.__elementLimit){for(var c=[],r=0;this.__queue.length>this.__elementLimit&&r++<this.__queue.length;){var s=this.__queue.shift();this.__inView.has(s)||this.__queries.has(s)||c.push(s)}if(c.length){setTimeout(function(){var e=L.call(a,a.element,c),t=!0,i=!1,n=void 0;try{for(var r,s=e.entries()[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var l=_slicedToArray(r.value,2),o=l[0],_=l[1];a.__cacheQueue.push(o),a.__cache.set(o,_),a.__domElements.delete(o),a.__domDelete&&__domDelete(_)}}catch(e){i=!0,n=e}finally{try{t||null==s.return||s.return()}finally{if(i)throw n}}for(;a.__cacheSize&&a.__cacheQueue.length>a.__cacheSize;){var h=a.__cacheQueue.shift();a.__cache.delete(h)}}.bind(this),0)}}var l=[],o=this.__uniqueIdentifier,_=null,h=!0,u=!1,d=void 0;try{for(var f,m=n[Symbol.iterator]();!(h=(f=m.next()).done);h=!0){var v=f.value;this.__size&&v>=this.__size||(this.__spinner&&function(){a.__spinner(!0),clearTimeout(a.__spinnerTimeout);var e=a.__spinner;a.__spinnerTimeout=setTimeout(function(){return e(!1)},100)}(),this.__queries.has(v)||(this.__queue.push(v),this.__cache.has(v)?I.call(this,v,this.__cache.get(v),o):(this.__queries.add(v),l.push(v))),_=v)}}catch(e){u=!0,d=e}finally{try{h||null==m.return||m.return()}finally{if(u)throw d}}if(_&&w.call(this,_),l.length){console.log("loading ".concat(l));var y=I.bind(this),E=this.__query.bind(this);if(this.__batchLoad)E(l,function(e){return y(l,e,o)});else for(var p=function(){var t=l[S];E(t,function(e){return y(t,e,o)})},S=0;S<l.length;S++)p()}},e.prototype.updateItem=function(t){var i=this;if(this.__domElements.has(t)){var n=1e3*Math.random()>>>0;this.__updateRequests.set(t,n);for(var e=arguments.length,r=new Array(1<e?e-1:0),s=1;s<e;s++)r[s-1]=arguments[s];this.__query.apply(this,[t,function(e){e&&(e.constructor===Array&&(e=e[0]),i.__updateRequests.get(t)===n&&g.call(i,t,e,!0))}].concat(r))}},e.prototype.updateSize=function(e){if(!e||+e<0)throw Error("Invalid size ".concat(e));var t=+e;if(t!==this.__size){this.__size=t,f.call(this);var i=t*this.__childSize;i<Number.parseInt(this.__dummyElement.style.top)&&(this.__dummyElement.style.top="".concat(i,"px"),this.__currentScrollHeight=i,this.element.scrollTop=i-this.element.clientHeight);var n=[],r=!0,s=!1,l=void 0;try{for(var o,_=this.__domElements[Symbol.iterator]();!(r=(o=_.next()).done);r=!0){var h=o.value;t<=h&&n.push(h)}}catch(e){s=!0,l=e}finally{try{r||null==_.return||_.return()}finally{if(s)throw l}}if(console.log("removing elements "+JSON.stringify(n)),n.length){L.call(this,this.element,n);for(var a=0;a<n.length;a++){var c=n[a];this.__domElements.delete(c),this.__cache.delete(c);var u=this.__queue.indexOf(c);-1!==u&&this.__queue.splice(u,1);var d=this.__cacheQueue.indexOf(c);-1!==d&&this.__cacheQueue.splice(d,1)}}}},e.prototype.dispose=function(){window.removeEventListener("resize",this.__resizeListener),this.element.removeEventListener("scroll",this.__scrollListener)},S in window)throw new Error("CLASH: Global property ".concat(S," exist already in window!"));window[S]=e}();