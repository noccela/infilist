/* InfiScroll */"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var i=[],n=!0,r=!1,o=void 0;try{for(var s,l=e[Symbol.iterator]();!(n=(s=l.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){r=!0,o=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}return i}function _arrayWithHoles(e){if(Array.isArray(e))return e}var debugView=document.getElementById("debug-view");!function(){var _="InfiScroll",h=Object.freeze({TRESHOLD:"treshold",ELEMENT_LIMIT:"elementLimit",SIZE:"size",QUERY:"generator",FIXED_SIZE:"fixedSize",CHILD_SIZE:"childSize",CACHE_SIZE:"cacheSize",INVALIDATE_CHECK:"checkFunction"});if(!window)throw new Error("".concat(_," cannot be used in non-browser environment"));function u(e,t,i,n){if(!n)return[0];var r,o,s=Math.max(e-i,0),l=t+2*i,_=s/n>>>0,h=_*n,c=l-(h-e),a=Math.ceil(c/n);return console.log("top "+s),console.log("totalHeight "+l),console.log("firstChildInView "+_),console.log("firstChildExcess "+h),console.log("viewLeft "+c),console.log("childrenInView "+a),r=_,o=a,Array.from(Array(o||1),function(e,t){return r+t})}function s(e){return"__".concat(_,"_index_").concat(e)}function d(n){for(var r=new Map,e=arguments.length,t=new Array(1<e?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return t.reduce(function(e,t){return e.concat(t)}).forEach(function(e){var t=s(e),i=document.getElementById(t);i&&(console.log("Removing child "+t+" from DOM"),r.set(e,i),n.removeChild(i))}),r}function l(e,t,i){var n=this;if(t.style.position="absolute",t.style.margin=0,t.style.top="".concat(e*this.__childSize,"px"),t.style.left=0,t.style.right=0,t.id=s(e),i){var r=s(e),o=document.getElementById(r);this.element.insertBefore(t,o),this.element.removeChild(o)}else this.element.appendChild(t);this.__childSize||(this.__childSize=t.scrollHeight,this.__treshold=function(){return this.__tresholdFactor*this.__childSize}.call(this),setTimeout(function(){return n.invalidate()},0),this.__fixedSize&&c.call(this)),e===this.__size||(this.__dummyElement.top="".concat((e+1)*this.__childSize+this.__treshold,"px"),this.__dummyElement.parentNode&&this.element.removeChild(this.__dummyElement),this.element.appendChild(this.__dummyElement))}function c(){!1!==this.__fixedSize&&(this.__dummyElement.style.top="".concat(this.__childSize*(this.__size+1),"px"),this.element.appendChild(this.__dummyElement))}function m(e,t){if(null!=t){if(!(t instanceof HTMLElement))throw Error("".concat(_," query callback resolved with non-HTMLElement result."));this.__queries.delete(e),this.__cache.delete(e);var i=this.__cacheQueue.indexOf(e);-1!=i&&this.__cacheQueue.splice(i,1),this.__domElements.add(e),l.call(this,e,t)}}function e(e,t){var i=this;if(!(e instanceof HTMLElement))throw Error("".concat(e," is not instance of HTMLElement"));this.element=e;var n=window.getComputedStyle(e);if(!~["absolute","relative"].indexOf(n.position))throw Error("".concat(e," must have position of 'absolute' or 'relative'"));if(!t)throw Error("options argument must be passed to ".concat(_," constructor"));this.__resizeListener=function(){i.invalidate()},window.addEventListener("resize",this.__resizeListener);var r,o,s=null;for(this.__scrollListener=function(){null!==s&&clearTimeout(s),s=setTimeout(function(){i.invalidate(),s=null},50)},e.addEventListener("scroll",this.__scrollListener);this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.__domElements=new Set,this.__inView=new Set,this.__queue=[],this.__cacheQueue=[],this.__cache=new Map,this.__queries=new Set,this.__updateRequests=new Map,function(t){for(var e=arguments.length,i=new Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];var r=i.filter(function(e){return!(e in t)});if(r.length)throw Error("Options object is missing required properties ".concat(r))}(t,h.QUERY),this.__query=t[h.QUERY],this.__check=t[h.INVALIDATE_CHECK],this.__childSize=t[h.CHILD_SIZE],this.__fixedSize=t[h.FIXED_SIZE],this.__size=t[h.SIZE],this.__elementLimit=t[h.ELEMENT_LIMIT],this.__cacheSize=t[h.CACHE_SIZE],this.__tresholdFactor=h.TRESHOLD in t?t[h.TRESHOLD]:.5,this.__childSize&&(this.__treshold=this.__tresholdFactor*this.__childSize),(o=Object.keys(t).filter(function(e){return!~Object.values(h).indexOf(e)})).length&&(r="Options object contained invalid options '".concat(o,"'. Typos?"),console.warn("".concat(_,": ").concat(r)));var l=document.createElement("div");l.style.height=l.style.width="1px",l.style.visibility="none",l.style.position="absolute",this.__dummyElement=l,c.call(this),setTimeout(function(){return i.invalidate()},0)}if(e.prototype.reload=function(){d(this.element,Array.from(this.__domElements)),this.__domElements.clear(),this.__inView.clear(),this.__cache.clear(),this.__queries.clear(),this.__queue=[],this.__cacheQueue=[],this.__dummyElement.top=0,this.invalidate()},e.prototype.invalidate=function(){var c=this;if((!this.__check||this.__check())&&null!==this.element.offsetParent){var e=u(this.element.scrollTop,this.element.clientHeight,this.__treshold,this.__childSize),t=e.filter(function(e){return!c.__domElements.has(e)});if(this.__inView=new Set(e),t.filter(function(e){return!c.__size||e<=c.__size}).forEach(function(e){return c.__queue.push(e)}),this.__elementLimit){for(var a=[],i=0;this.__queue.length>this.__elementLimit&&i++<this.__queue.length;){var n=this.__queue.shift();this.__inView.has(n)||this.__queries.has(n)||a.push(n)}a.length&&setTimeout(function(){var e=d(c.element,a),t=!0,i=!1,n=void 0;try{for(var r,o=e.entries()[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=_slicedToArray(r.value,2),l=s[0],_=s[1];c.__cacheQueue.push(l),c.__cache.set(l,_),c.__domElements.delete(l)}}catch(e){i=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}for(;c.__cacheSize&&c.__cacheQueue.length>c.__cacheSize;){var h=c.__cacheQueue.shift();c.__cache.delete(h),console.log("removed from cache "+h)}},0)}var r=!0,o=!1,s=void 0;try{for(var l,_=function(){var t=l.value;if(c.__size&&t>c.__size)return"continue";c.__queries.has(t)||(c.__cache.has(t)?m.call(c,t,c.__cache.get(t)):c.__query(t,function(e){return m.call(c,t,e)}))},h=t[Symbol.iterator]();!(r=(l=h.next()).done);r=!0)_()}catch(e){o=!0,s=e}finally{try{r||null==h.return||h.return()}finally{if(o)throw s}}}},e.prototype.updateItem=function(t){var i=this;if(this.__domElements.has(t)){var n=1e3*Math.random()>>>0;this.__updateRequests.set(t,n);for(var e=arguments.length,r=new Array(1<e?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];this.__query.apply(this,[t,function(e){i.__updateRequests.get(t)===n&&(l.call(i,t,e,!0),console.log(t+" updated in-place"))}].concat(r))}},e.prototype.dispose=function(){window.removeEventListener("resize",this.__resizeListener),this.element.removeEventListener("scroll",this.__scrollListener)},_ in window)throw new Error("CLASH: Global property ".concat(_," exist already in window!"));window[_]=e}();